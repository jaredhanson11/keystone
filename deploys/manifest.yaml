# This manifest maps deployment payload -> stacks to deploy
#
## Deploys Structure ##
# deploys/
#   manifest.yaml
#   <namespace>/
#     <app>.yml # stack = _default
#     <app>.<stack>.yml
#
# Manifest Entry #
# <payload.deploy>:
#   - name: str # used to find
#     chartName: str # name of chart in helm repo (i.e stable/postgres)
#     namespace: str # name of k8s namespace (and values file directory)
#     stacks: list # if empty deploy all stacks, else deploy only stacks defined here
#
# NO YAML ANCHORS ALLOWED -> https://github.com/mikefarah/yq/issues/339

endergy-master: []

# tools
py-repo:
  - name: "py-repo"
    chartName: "vamble/py-repo"
    namespace: "tools"
    stacks: []

helm-repo:
  - name: "helm-repo"
    chartName: "vamble/helm-repo"
    namespace: "tools"
    stacks: []

# common
postgresql:
  # Installed with:
  #   --set existingSecret=postgres-secrets
  - name: "postgresql"
    chartName: "stable/postgresql"
    namespace: "common"
    stacks: []

# development

## Summn
redwood-staging:
  - name: "redwood"
    chartName: "vamble/flask-app"
    namespace: "development"
    stacks: []

whittle-staging:
  - name: "whittle"
    chartName: "vamble/webclient-app"
    namespace: "development"
    stacks: []

autotroph-worker-staging:
  - name: "autotroph-worker"
    chartName: "vamble/rmq-worker"
    namespace: "development"
    stacks: []

autotroph-job-staging:
  - name: "autotroph-job"
    chartName: "vamble/simple-job"
    namespace: "development"
    stacks: []

# Production
rabbitmq-prod:
  - name: "rabbitmq"
    chartName: "bitnami/rabbitmq"
    namespace: "production"
    stacks: []

whittle-landing-page-prod:
  - name: "whittle-landing-page"
    chartName: "vamble/webclient-app"
    namespace: "production"
    stacks: []

whittle-prod:
  - name: "whittle"
    chartName: "vamble/webclient-app"
    namespace: "production"
    stacks: []

redwood-prod:
  - name: "redwood"
    chartName: "vamble/flask-app"
    namespace: "production"
    stacks: []

autotroph-job-prod:
  - name: "autotroph-job"
    chartName: "vamble/simple-job"
    namespace: "production"
    stacks: []

autotroph-worker-prod:
  - name: "autotroph-worker"
    chartName: "vamble/rmq-worker"
    namespace: "production"
    stacks: []

## Keeping landing page up for summn
summn-landing-page-prod:
  - name: "summn-landing-page"
    chartName: "vamble/landing-page"
    namespace: "production"
    stacks: []
